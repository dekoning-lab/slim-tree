initialize() {
	initializeSLiMModelType("nonWF");
	setSeed(1824955);
	initializeSLiMOptions(nucleotideBased=T);
	initializeAncestralNucleotides("p2.fasta");
	mm = mmJukesCantor(0.0005);
	initializeMutationTypeNuc("m1", 0.5, "f", 0.0);
	m1.convertToSubstitution = F;
	initializeGenomicElementType("g1", m1, 1.0, mm);
	initializeGenomicElementType("g2", m1, 1.0, mm);
	initializeRecombinationRate(2.5e-08);
	initializeGenomicElement(g1, 0, 899);
}


function (void) setup_fitness(void){
	sim.setValue("A", c(0.987726672305739, 0.97761615895744, 0.983892785887115, 1.0, 0.84884072438731, 0.98158995425744, 0.994620637217624, 0.989837392365474, 0.996333912674007, 0.987241284548476, 0.986172793435908, 0.985664948511789, 0.982279523126815, 0.991587491266162, 0.983253905235152, 0.994578634813875, 1.0, 0.995395076735285, 1.0, 0.996059081804086, 0.990080236998505, 0.994368250248661, 0.993291419831348, 0.99926274177566, 0.994478700269348, 0.995814258654067, 0.993470509974627, 0.996953147506964, 0.994479155561131, 1.00173195757517, 0.995677003363659, 0.988184126340606, 0.995845107578926, 0.99495782827713, 1.0, 0.990221512035706, 0.988921511531672, 1.0, 0.989070886043961, 0.990995966053582, 0.997290520630985, 1.00174976562841, 1.0, 0.991241291910598, 0.992762095104016, 0.990466043427598, 0.991433400330117, 0.994793131759162, 0.996516027905022, 1.0, 1.0));
	sim.setValue("C", c(0.837653020601935, 0.839442229747036, 0.841686849811239, 0.988065567823666, 0.980983020879981, 0.837903111771048, 0.987654394400442, 0.987799897102413, 0.983254777789321, 0.838123656377074, 0.986171577778213, 0.980144380514229, 0.982279814137616, 0.842315704527706, 0.986737275733971, 0.836505934827931, 0.988957161224272, 0.987307131220332, 0.988685675814298, 0.98976328296607, 0.985476939109844, 0.989763404103317, 0.83932233316247, 0.840591242229812, 0.840916737639276, 0.840182303258852, 0.98998723053898, 0.993469926464787, 0.986392013148597, 0.994765564517631, 0.839775497603063, 0.984701489231247, 0.841973404186824, 0.840773690876021, 0.992878671741637, 0.83962932910529, 0.984317043432713, 1.00236116131685, 0.987950218006553, 0.986391695528133, 0.990995067044409, 0.841372874281733, 0.840911797348938, 0.840068146398906, 0.841394452257083, 0.986982396313363, 0.840579388283503, 0.838914774098923, 0.994478485985389, 0.990593078988823, 1.0));
	sim.setValue("D", c(0.996293266082833, 0.845582581503006, 0.846283206660273, 0.98458199752535, 0.838717957993195, 1.0, 0.991137357325919, 0.987799894172063, 0.983254713228799, 0.998812039557335, 0.841648158657707, 0.980144363697916, 0.9822798141852, 1.0, 0.840167243082298, 0.983824112417128, 0.994478384504582, 0.99079058665342, 0.992169240376784, 1.00080512289169, 1.0, 0.989763406157659, 0.994982261525293, 0.999999476395152, 1.00067044166613, 0.997505054463717, 0.989987218616047, 0.993469926479415, 0.995395464118798, 0.991282130771822, 0.99263113167348, 0.991667286224095, 0.99651608762157, 0.993357530031426, 0.839475661333121, 0.994825934309699, 0.841169080285047, 0.838947864151267, 0.984467466227056, 0.986391696246957, 0.997961575195887, 1.00203697349107, 0.99627119124238, 0.98842948360536, 0.994982368063179, 0.842284412923939, 1.0, 0.99667600442425, 0.990995288640158, 0.999596987828394, 1.0));
	sim.setValue("E", c(0.992331149760861, 0.845582581544223, 0.846283206638053, 0.984582225117122, 0.845326737197246, 0.992039445248659, 0.987654390121453, 0.991283040476949, 0.983254782766758, 1.0, 0.841672025028368, 0.983627492898571, 0.982279814433356, 0.999999419432126, 0.842320248456337, 0.987307660817948, 0.9979615937216, 0.992828121822118, 0.995652483668688, 0.995284389023283, 0.999408271248314, 0.995284414002425, 1.0, 1.00274589396245, 1.00323742603953, 1.0, 0.996953653845231, 1.0004363010919, 0.991912235831664, 0.991282101360966, 0.996114232727697, 0.991667286207737, 1.00059113794655, 0.999280420854528, 0.985911628197226, 1.0, 0.843184135885152, 0.841091926513132, 0.984467467216301, 0.993357804799995, 0.996515883842484, 1.00203697349143, 1.00211615625039, 0.996995773386453, 0.997690808572511, 0.843912913623052, 0.998991552007328, 0.996004997840806, 0.994478477521062, 1.0026428365397, 1.0));
	sim.setValue("F", c(0.84509428237961, 0.977617492943211, 0.992895823449853, 0.841822081245815, 0.999644927814965, 0.842386040069728, 0.837681049776883, 0.837420398699981, 0.836244291211454, 0.846080209017118, 0.993139218003922, 0.980144365472221, 0.995168669161336, 0.843450021183174, 1.00382940595722, 0.836691141190695, 0.988957164418012, 0.987307131901398, 0.840832041131839, 0.839829422330642, 0.988959085909172, 0.993246859865228, 0.985204593504185, 0.840559894164455, 0.842393345270844, 0.841644243077998, 0.99347041604775, 1.00391947659186, 0.998878498270566, 0.996803130769915, 0.840770267400102, 0.984701489235496, 0.842132147681971, 0.986391589813217, 0.838307587071798, 0.839927036075952, 0.98227963814681, 0.990790196488191, 0.999999743293257, 0.986391695586867, 0.994478367573455, 0.84222861556503, 0.841535751207173, 0.840364529444949, 0.842541518078212, 1.00059125369769, 0.841954103518929, 0.840726549023844, 0.999082971148219, 0.996113795441109, 1.0));
	sim.setValue("G", c(1.0, 0.848050252197059, 0.848908257952063, 0.991548681909805, 0.846532547475136, 0.987110640461532, 0.989691810376258, 0.987799882037295, 1.0, 0.983758114920044, 0.845404336196087, 0.97666117241024, 0.978796694288558, 0.989549951860673, 0.844280139429472, 0.985862005725136, 0.990995230995693, 0.98382359454231, 0.998092362370456, 0.996730092574611, 0.985475938625329, 0.986280183374655, 0.981721421328509, 0.987949575600542, 0.990220953478088, 0.988847936847143, 0.843295242233547, 0.98998677283117, 0.992686819949189, 0.996803154459925, 0.987110437072252, 0.986738544752014, 0.989549678337305, 0.988428761304667, 0.987949867500689, 0.98325526289523, 0.975314486836867, 0.991911649212211, 0.980984423383219, 0.982908602752619, 0.994478373946388, 1.00144510828578, 0.990221104165595, 0.981463740580681, 0.989808426720217, 0.844908055589837, 0.989071593079097, 0.99083100605025, 0.987512169420288, 0.99407630298696, 1.0));
	sim.setValue("H", c(0.987726404880097, 0.845552730697707, 0.845944615795953, 0.836638141712136, 0.984467164760459, 0.987110631704436, 0.98765438552895, 0.993320735649594, 0.83735408829977, 0.98172209147698, 0.837784202386621, 0.980144364021324, 0.99845474234416, 0.991587462586234, 0.841836600316885, 0.983824115931148, 0.992440801643827, 0.987307122089167, 0.992169258120592, 0.996730023076206, 0.99244204819082, 0.993246853608426, 0.988687110598962, 0.987949085451047, 0.988182898284142, 0.984243761410245, 0.993470415048621, 1.00504082043637, 0.996840981536313, 0.991282129861023, 0.990593653188155, 1.0, 0.995070425598285, 0.991911847687852, 0.843377539081989, 0.986738413838969, 0.841242074280722, 0.987306704386876, 0.9914334594388, 0.989874420362031, 0.997961575183879, 0.99099543077909, 0.988183388592418, 0.990466771562099, 0.990724619163007, 0.986982400307799, 0.984468446590356, 0.986225713870257, 1.00077380680708, 1.00104260821523, 1.0));
	sim.setValue("I", c(0.841541910643064, 0.994239861248501, 1.00275347182109, 0.842740062517801, 0.978944870955915, 0.842137422898165, 0.985616784054528, 0.985762500605624, 0.839877315439954, 0.842699118426144, 0.997397049863627, 0.992902919081341, 0.980242353309029, 0.844900792500407, 0.994479064404335, 0.981786706516007, 0.993886540001371, 0.996311291742353, 0.842927860896468, 0.987725767947533, 0.98895894904427, 0.995813895219091, 0.992944662101072, 0.985911502600279, 0.843684047249849, 0.843100228144266, 1.00274603241962, 0.998398787897273, 0.984354497021036, 0.998248791687342, 0.985072751255782, 0.98266402686637, 0.987512037883954, 0.987836944650953, 0.992878672484477, 0.981218592275946, 0.991555006994122, 0.985268378087547, 0.989395824858948, 0.995924715551324, 0.992440830928424, 0.988957840111763, 0.986145882524096, 0.986391846676471, 0.844124687543689, 1.0, 0.843341169429695, 0.841757857846556, 0.997961663711497, 0.988555565376576, 1.0));
	sim.setValue("K", c(0.992331147775984, 0.84179732660033, 0.842497951691252, 0.836565676676255, 0.845356948750139, 0.985073116324455, 0.987654390372648, 1.00521575075978, 0.837330335282181, 0.987241268957785, 0.838997409123355, 0.98014436569671, 0.982279814372186, 0.99855378345256, 0.84209046194196, 0.987307660821762, 0.997045402155296, 0.990790568325655, 1.000256960378, 0.996730042357434, 0.992442048193613, 1.00181348543339, 0.994982265974484, 0.993470129501855, 1.00023320602583, 0.991209767907926, 0.996953659840685, 1.00391947662083, 0.989874791631437, 0.991282088158401, 0.9999996281461, 0.994479364953273, 1.0024390175336, 0.995395105591895, 0.84112442776492, 0.995742116518123, 0.843084877033744, 0.839178674358135, 0.984467422891274, 1.0, 1.00203656232776, 0.996516321150238, 1.00107277661974, 1.0, 1.0, 0.842234161257298, 0.989987842789326, 0.994314421344935, 0.996515989586628, 0.99755945490649, 1.0));
	sim.setValue("L", c(0.847760038528868, 0.982544904837649, 1.0, 0.847800961432837, 0.98098364349857, 0.848585476339461, 0.98213316659558, 0.985762366085182, 0.97773412271769, 0.847895796816239, 1.0, 0.985072993163613, 0.982279457451432, 0.980546081475001, 1.0, 0.981786966339736, 0.990403395535036, 0.99383651774123, 0.986648569307458, 0.984242614667819, 0.988042649205755, 1.0, 0.987770800103668, 0.985912087599321, 0.982662244272652, 0.978723094623437, 1.0, 1.0, 0.986391569674434, 1.0, 0.987110466538151, 0.982663623480217, 0.984028977873517, 0.993357560486129, 0.985912363307967, 0.981217749639774, 0.986884027486965, 0.987307123282087, 0.990516985805011, 0.990649196487483, 0.995253011422763, 0.985474665031752, 0.986146016323532, 0.986391713665282, 0.979684853021104, 0.996258474904469, 0.978947807144485, 0.980705111136324, 0.997045472868052, 0.993160126592363, 1.0));
	sim.setValue("M", c(0.836214610239976, 0.984582529004977, 0.997824827551527, 0.838629366013568, 0.984465715256937, 0.83712981707517, 0.991137472592449, 0.991282720706011, 0.83533859708254, 0.837206056979143, 1.00445236499867, 0.99059372561108, 0.985762982835253, 0.83869222683473, 0.999999716166158, 0.830820541978723, 0.995923953745914, 0.994273725121064, 0.992168839628877, 0.993246438283038, 0.992442238797841, 1.0048177148654, 0.988687745974232, 0.834874501315261, 0.837295225881084, 0.836871378479458, 1.00043676948247, 1.00247380908825, 0.989875431105165, 1.00633647857874, 0.833671064972141, 0.988184695195662, 0.993032839479935, 0.997961988476939, 0.992878648059632, 0.986739869678741, 0.987800205576323, 0.994273341926308, 0.99347089744861, 0.99335781917726, 1.00144467533546, 0.835929564495947, 0.834881373658735, 0.988430014537957, 0.837570256712141, 0.997432346507965, 0.837269428222559, 0.835574044716083, 1.00144478454276, 0.994076230143225, 1.0));
	sim.setValue("N", c(0.997132732788667, 0.841496582387358, 0.842343300240896, 0.984581997540761, 0.838763207165843, 0.997962323345733, 0.996658110056156, 0.993320736125243, 0.983254704279481, 0.988686899412473, 0.837987275981935, 0.983627475248219, 0.989245865445395, 0.999328404467066, 0.840075497345885, 0.983824119984652, 0.995924052151254, 0.987307144474285, 0.995652484134794, 1.00506287665996, 0.996517032471747, 0.993246854117111, 0.98868712802233, 0.991432675549728, 0.993704060817368, 0.989764137405989, 0.989987221682151, 0.996953142222433, 0.99684098178608, 0.994765563501936, 0.990593653193258, 0.998633512114067, 0.999328258029112, 0.991911848779981, 0.841086833601649, 0.990221475213381, 0.839556088592392, 0.99079015933966, 0.984467422869306, 0.989874420276425, 1.00203655592582, 0.99999945290365, 0.993704190870428, 0.988429483605576, 0.99498233797088, 0.840846002570402, 0.994916550833574, 0.994314421345148, 0.99999915836499, 0.9961137954543, 1.0));
	sim.setValue("P", c(0.980760491137952, 0.843555256001764, 0.843980582171078, 0.984582363508482, 0.847444155246277, 0.978107094796749, 0.987654399799181, 0.984316540251406, 0.979771643117513, 0.978237925650093, 0.840731763897103, 0.976661172070146, 0.840954574593508, 0.982583590294578, 0.843409893647824, 1.0, 0.990995232407734, 1.0, 0.985202528189673, 0.98628012947482, 0.981993709855526, 0.986280254445374, 0.98172141928258, 1.0, 1.0, 0.980760603391019, 0.986504081736314, 0.989986772808789, 0.988429062715014, 0.98779897811127, 1.0, 0.98121839691203, 0.986066498951481, 0.982908095114976, 0.982427954436495, 0.841925376025389, 0.975314486843067, 0.983823277042585, 0.980984423390888, 0.982908603121639, 1.0, 0.994478875755329, 0.988183533001617, 0.981463743324499, 0.981722359305301, 0.843747761000311, 0.98795029716761, 1.0, 0.987512133624937, 0.990593131362389, 1.0));
	sim.setValue("Q", c(0.989764179205043, 0.845522700562332, 0.845912666798582, 0.98458222710282, 0.839977054744767, 0.985073117829609, 0.987654385334789, 0.99824944182023, 0.838804332989887, 0.990724366631406, 0.986171792667835, 0.983627492890128, 0.987800194840849, 0.997108147529011, 0.845282766720799, 0.987307630980494, 0.995924052349591, 0.992828121820409, 0.997690007187849, 0.99528438902253, 0.993563297981868, 1.00080511337521, 0.996245120304084, 0.993470457819574, 0.997961906951774, 0.99402190279457, 0.998074948173287, 1.00324846368226, 0.989874790497794, 0.996803131104112, 0.996114224640274, 0.996750629057563, 0.999999270735247, 1.0, 0.841379957834322, 0.997187755472316, 0.843257307919478, 0.987306712833192, 0.984467501237665, 0.995395298896622, 1.00077367265228, 0.999083278186505, 0.999754366903461, 0.998878604904091, 0.997690808572294, 0.9869823812179, 0.991433447133252, 0.991747194538357, 0.999082964595106, 1.00163449710721, 1.0));
	sim.setValue("R", c(0.984243514230234, 0.8488664791986, 0.849567104318947, 0.979061358107782, 0.848444260923327, 0.976069727465327, 0.98213316661429, 1.0, 0.841766851247812, 0.976201163582383, 0.844470103964433, 0.974623690044823, 0.982279457469358, 0.989549931486561, 0.847918576968773, 0.981786966572315, 0.990403367303043, 0.985269896572935, 0.99565246495892, 0.989763710629232, 0.985475799328273, 0.99673017082051, 0.986649476693223, 0.982428386647755, 0.988183388156772, 0.984243471318565, 0.991432953549909, 0.999999094111437, 0.984354115584479, 0.989244899267292, 0.993639487400257, 0.990751026508348, 0.995070473381865, 0.990648995413822, 0.844271214991056, 0.986738256662669, 0.844132463547959, 0.98178582223309, 0.978946862286952, 0.99375996092346, 0.995253007982484, 0.988958232867765, 0.993112325493256, 0.993358038606824, 0.992944897485516, 0.981461769831216, 0.982429778235434, 0.986226535458002, 0.992440953212637, 0.995521943439851, 1.0));
	sim.setValue("S", c(0.986810501250656, 0.845618168905791, 0.846424061028178, 0.99615320686581, 0.84728694763247, 0.985073108812554, 1.0, 0.987800046029824, 0.988183847734156, 0.981720604829742, 0.980652229933719, 0.982711236772816, 0.980242027702187, 0.990324579193432, 0.844382909814399, 0.98875342492838, 0.996326332319795, 0.988753063766579, 0.996427205981062, 1.0, 0.988042660903675, 0.989763749436747, 0.985203871319039, 0.991432789840043, 0.990750411925315, 0.988501236334223, 0.984466572691384, 0.991432477457797, 0.992920585112838, 0.996803213262271, 0.990593531560008, 0.988184084737577, 0.99691834621783, 0.98895819262069, 0.990170143891101, 0.983255189807711, 0.976758977335884, 0.996582728706563, 0.984467069194709, 0.986391530824059, 0.996515845751378, 1.0, 0.993112336323293, 0.984946111109078, 0.988687071786575, 0.981461766822365, 0.991835616581881, 0.993595104956479, 0.996516020620141, 0.994076324795714, 1.0));
	sim.setValue("T", c(0.980760491132288, 0.977616191794663, 0.983892785947056, 0.990877687376739, 0.848882565616486, 0.981589929334645, 1.00189158292979, 0.989837392531958, 0.979771641136979, 0.981720556617495, 0.986172792299133, 0.99118560893169, 0.978796694284864, 0.989549952367756, 0.98325388304915, 0.987307648052249, 0.998736251477216, 0.992828063462571, 0.99329067061848, 0.997851389642144, 0.990080234657474, 0.99324691118445, 0.992761977426434, 0.989987129854619, 0.990220953479693, 0.98772661674569, 0.993470511965325, 0.995507510883738, 0.989874677695301, 0.998840725556224, 0.991714886397157, 0.986738544677647, 1.0, 0.989874386246434, 0.994916139702534, 0.986738302142628, 0.982279483160275, 0.994865398158446, 0.984467069549669, 0.994958015908977, 0.996515835365229, 0.997290943381699, 0.993704253438563, 0.98955053812081, 0.987241521230178, 0.989020373662114, 0.992025268278478, 0.991747198224356, 1.0, 0.995197636899954, 1.0));
	sim.setValue("V", c(0.84238437842141, 0.8415368510905, 0.841819405422753, 0.842958165629657, 0.984467074578625, 0.843375806561948, 0.841530248727239, 0.841791124249477, 0.83911371000261, 0.843189819767765, 0.84052645645877, 0.842217722924591, 0.9843170436556, 0.846082736384203, 0.986738074372621, 0.839779339327368, 0.844055975109177, 0.842313692418185, 0.844913440463369, 0.843507956306642, 0.84365361712175, 0.986280337700345, 0.843715831945642, 0.843389321173809, 0.844592714718214, 0.843679387224305, 0.986504081746391, 0.995507510922456, 0.986391638814856, 0.987798978113003, 0.84301611510394, 0.843591085167303, 0.84514004761344, 0.844707854206875, 0.841871045960598, 0.842226218628562, 0.841557968785969, 0.983823277168586, 0.992026204089577, 0.845073261174824, 0.846161456043448, 0.844529233170741, 0.843878781230513, 0.844041564417311, 0.845339597017181, 0.986982799620396, 0.844261876396105, 0.842919954812288, 0.987512165434821, 0.99059313136561, 1.0));
	sim.setValue("W", c(0.834214385035871, 1.0, 1.00591229858595, 0.993586206204124, 0.984465715259688, 0.835625734123486, 0.99462014462064, 0.991282720417847, 0.986737935244924, 0.985204362408471, 0.999434475151513, 1.0, 0.98576298338907, 0.989549864414725, 0.997187672308071, 0.992828309576433, 1.00348226942181, 1.00405210366433, 0.992168839635717, 0.993246438988383, 0.995925205459872, 1.00021320813946, 1.00157612392672, 0.996953451235008, 0.99166605634953, 0.991209796921514, 1.00799496578493, 1.00504076721083, 0.993357951983196, 1.00580702911009, 0.994076741297133, 0.988184697221817, 0.996515989790861, 0.995395056087615, 1.00576821618375, 0.99022156594807, 1.0, 0.99979414836702, 0.996037219364798, 1.00313618866293, 0.997961494659695, 0.994478712301338, 0.995149830746792, 0.993949926986829, 0.988688578604232, 1.00552003602244, 0.987951621608881, 0.989708937422605, 1.00492797130962, 1.00104260643294, 1.0));
	sim.setValue("X", c(0.834214385035871, 0.839442229747036, 0.841686849811239, 0.836565676676255, 0.838717957993195, 0.835625734123486, 0.837681049776883, 0.837420398699981, 0.83533859708254, 0.837206056979143, 0.837784202386621, 0.842217722924591, 0.840954574593508, 0.83869222683473, 0.840075497345885, 0.830820541978723, 0.844055975109177, 0.842313692418185, 0.840832041131839, 0.839829422330642, 0.84365361712175, 0.986280183374655, 0.83932233316247, 0.834874501315261, 0.837295225881084, 0.836871378479458, 0.843295242233547, 0.989986772808789, 0.984354115584479, 0.98779897811127, 0.833671064972141, 0.843591085167303, 0.841973404186824, 0.840773690876021, 0.838307587071798, 0.83962932910529, 0.839556088592392, 0.838947864151267, 0.978946862286952, 0.845073261174824, 0.846161456043448, 0.835929564495947, 0.834881373658735, 0.840068146398906, 0.837570256712141, 0.840846002570402, 0.837269428222559, 0.835574044716083, 0.987512133624937, 0.988555565376576, 1.0));
	sim.setValue("Y", c(0.837653020599784, 0.845582581529552, 0.846162718884852, 0.838407107201723, 1.0, 0.981590466603778, 0.838131180536338, 0.987799894285854, 0.837258391601609, 0.838357617183743, 0.986171577784712, 0.980144362377423, 1.0, 0.842703959192349, 0.994825773554273, 0.837825007785586, 0.988957161238596, 0.987307149656851, 0.988685676801969, 0.989763281429177, 0.990996464089883, 0.989763413242073, 0.985204592487514, 0.841580370944477, 0.841761437579376, 0.841072902604779, 0.989987226716225, 1.00551973096643, 1.0, 0.991282128846388, 0.840972315085995, 0.99166728110573, 0.843017645738671, 0.986391589808643, 0.843244520349807, 0.840525575896898, 0.978797727727881, 0.990790159349698, 1.0, 0.986391697168698, 0.994478368073719, 0.84250190762297, 0.842090409012793, 0.984946846396775, 0.842337408103356, 0.997432336578113, 0.841061689613351, 0.839915249886103, 0.999999202306269, 0.998680791339687, 1.0));

	sim.setValue("fitness_profiles0",c(49, 41, 40, 47, 46, 39, 40, 24, 13, 37, 39, 23, 45, 38, 11, 21, 14, 0, 41, 5, 36, 40, 6, 10, 28, 48, 0, 15, 22, 41, 29, 15, 18, 29, 7, 6, 28, 0, 36, 15, 48, 36, 20, 31, 10, 45, 38, 29, 26, 33, 30, 37, 48, 29, 38, 20, 34, 6, 6, 33, 14, 6, 20, 25, 33, 4, 41, 16, 22, 16, 33, 20, 5, 23, 23, 29, 23, 41, 28, 24, 39, 26, 7, 37, 0, 19, 15, 2, 13, 43, 5, 32, 14, 45, 34, 38, 27, 19, 42, 14, 36, 7, 38, 22, 30, 8, 31, 7, 35, 13, 15, 25, 14, 22, 30, 32, 41, 44, 11, 1, 3, 34, 32, 19, 27, 6, 15, 15, 31, 7, 35, 46, 1, 25, 34, 14, 26, 0, 44, 4, 31, 33, 22, 14, 24, 2, 41, 38, 28, 7, 17, 4, 1, 23, 27, 46, 31, 40, 26, 10, 21, 45, 20, 31, 9, 29, 19, 31, 23, 36, 16, 17, 4, 32, 31, 42, 35, 46, 46, 42, 4, 5, 38, 19, 48, 14, 25, 45, 22, 5, 10, 21, 15, 31, 22, 44, 24, 27, 35, 28, 34, 9, 29, 0, 28, 17, 9, 35, 16, 1, 22, 2, 19, 39, 13, 23, 42, 43, 9, 3, 28, 40, 14, 39, 23, 47, 34, 25, 21, 22, 11, 43, 43, 48, 32, 27, 1, 36, 32, 40, 45, 36, 29, 43, 0, 1, 18, 27, 6, 48, 47, 1, 24, 47, 0, 12, 39, 31, 39, 29, 8, 29, 8, 8, 27, 22, 25, 21, 28, 46, 41, 39, 48, 43, 4, 20, 32, 24, 31, 41, 12, 6, 14, 40, 48, 14, 27, 28, 18, 3, 39, 19, 9, 21, 38, 40, 10, 8, 43, 49));
	defineConstant("start_stop_codon_positions",matrix(c(0, 897), ncol = 2, byrow = T));

	defineConstant("seq_length", 900);
	get_fitness();

	sim.setValue("fixations_p1", sim.chromosome.ancestralNucleotides(format = "integer"));
	sim.setValue("fixations_counted_p1", 0);
	sim.setValue("dN_p1", 0);
	sim.setValue("dS_p1", 0);
	sim.setValue("subs_p1", "\n\nSubstitutions:");
}


function (void) get_fitness (void){
	poses = start_stop_codon_positions;

	for (row_num in (0:(nrow(start_stop_codon_positions)-1))){
		fitnesses = c();
		aas = codonsToAminoAcids(sim.chromosome.ancestralNucleotides(drop(poses[row_num,0]), drop(poses[row_num, 1])+2, "codon"), paste = F);

		sim.setValue("ancestral_aa_seq" + asString(row_num),aas); 

		count = 0;
		for (aa in aas){
			fitnesses = c(fitnesses, sim.getValue(aa)[sim.getValue("fitness_profiles" + row_num)[count]]);
			count = count + 1; 
		}

		sim.setValue("ancestral_fitnesses" + asString(row_num), fitnesses);
		sim.setValue("ancestral_fitness_value" + asString(row_num), sum(fitnesses));
		sim.setValue("ancestral_aas" + asString(row_num), aas);

	}
}


function (float) get_genome_fitness (object nucs){
	fitness_value = 0.0;
	for (row_num in (0:(nrow(start_stop_codon_positions) -1))){

		anc_fit_val =  sim.getValue("ancestral_fitness_value" + asString(row_num));

		starting_pos = drop(start_stop_codon_positions[row_num,0]);
		ending_pos = drop(start_stop_codon_positions[row_num,1])+2;
		aa_stop_pos = (ending_pos - starting_pos + 1)/3 - 1;
		aa_seq = codonsToAminoAcids(nucs.nucleotides(start = starting_pos, end = ending_pos, format = "codon"), paste = F);

		poses = (aa_seq != sim.getValue("ancestral_aas" + row_num));

		if(sum(poses) == 0){
			codon_fit = anc_fit_val;
		}
		else if(any(poses[0] | poses[aa_stop_pos])){
			codon_fit = 0;
		}
		else{
		fitness_vals = sim.getValue("ancestral_fitnesses"+row_num);
			fitness_vals[poses] = sapply(which(poses), "sim.getValue(aa_seq[applyValue])[sim.getValue(\"fitness_profiles\" + row_num)[applyValue + starting_pos]];");

			if(any(aa_seq[poses] == "X")){
				early_stop_point = which(aa_seq[poses] == "X")[0];
				fitness_vals = fitness_vals[starting_pos:early_stop_point];
			}

			codon_fit = sum(fitness_vals);
		}

		fitness_value = fitness_value + codon_fit;
	}

	return fitness_value;
}


fitnessEffect() {return((get_genome_fitness(individual.genome1)+get_genome_fitness(individual.genome2)) / 595.9311263062923);//If error says total fitness < 0.0, mutation rate is lethal
}


reproduction(){
	subpop.addCrossed(individual, subpop.sampleIndividuals(1));
}


1087 late() {
	setup_fitness();
	sim.readFromPopulationFile("p2_1.txt");

	sim.setValue("fixations_p1", codonsToNucleotides(nucleotidesToCodons(readFile("p2_fixed_mutations.txt")), format = "integer"));
	sim.setValue("fixations_counted_p1", 0);
	sim.setValue("dN_p1", 0);
	sim.setValue("dS_p1", 0);
	sim.setValue("subs_p1", "\n\nSubstitutions:");
}


1087:1499late () {
}


1088:1500 early(){
	p1.fitnessScaling = 100/p1.individualCount;
	 p2.fitnessScaling = 0;
}


1500 late() {
	p1.individuals.tag = 0;
	sample(p1.individuals, asInteger(p1.individualCount* 0.5)).tag = 1;
	p1.individuals[p1.individuals.tag == 0].tag = 2;
	p2.takeMigrants(p1.individuals[p1.individuals.tag == 2]);
	sim.outputFull("p3_1.txt");
	p1.takeMigrants(p2.individuals);
	p2.takeMigrants(p1.individuals[p1.individuals.tag == 1]);
	sim.outputFull("p3_2.txt");
	p1.takeMigrants(p2.individuals);
	p2.removeSubpopulation();
	writeFile("p3.fasta", (">parent_ancestral_to_load\n" + sim.chromosome.ancestralNucleotides()));
	writeFile("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_MBE/EX_07/p3_fixed_mutations.txt", paste(codonsToNucleotides(nucleotidesToCodons(sim.getValue("fixations_p1"))), sep = ""));
	sim.outputFixedMutations();
	system("sbatch \"/work/dk_lab/work/afarinesh/SLiM_Tree_paper_MBE/EX_07/slimScripts/tree_p4.sh\"");
	system("sbatch \"/work/dk_lab/work/afarinesh/SLiM_Tree_paper_MBE/EX_07/slimScripts/tree_p5.sh\"");
}