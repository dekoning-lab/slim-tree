initialize() {
	setSeed(914348223);
	initializeSLiMOptions(nucleotideBased=T);
	initializeAncestralNucleotides("p3.fasta");
	mm = mmJukesCantor(0.0005);
	initializeMutationTypeNuc("m1", 0.5, "f", 0.0);
	m1.convertToSubstitution = F;
	initializeGenomicElementType("g1", m1, 1.0, mm);
	initializeGenomicElementType("g2", m1, 1.0, mm);
	initializeRecombinationRate(2.5e-08);
	initializeGenomicElement(g1, 0, 899);
}


function (void) setup_fitness(void){
	sim.setValue("A", c(0.987726717238382, 0.977616173428432, 0.983891950168294, 1.0, 0.848840724388297, 0.98158997520681, 0.994620661841415, 0.989837459745569, 0.996333912178956, 0.987241343350929, 0.986172707713369, 0.985664880964438, 0.982279508973908, 0.991587802964816, 0.983254547015425, 0.994578621981262, 1.0, 0.995395098498771, 1.0, 0.99605916429035, 0.990079887743557, 0.994368389524291, 0.99329126729696, 0.999262794517923, 0.994478737428913, 0.995814314459712, 0.993470541828268, 0.996953033646528, 0.994479195136821, 1.00173177524388, 0.995677005025806, 0.988184091072487, 0.995845147762714, 0.994957976822409, 1.0, 0.990221211021455, 0.988921473230679, 1.0, 0.989071106851635, 0.990995991206224, 0.997290481307923, 1.0017495389925, 1.0, 0.991241199185487, 0.992762176389325, 0.990465957282361, 0.9914333962329, 0.994793312683238, 0.996516047104055, 1.0, 1.0));
	sim.setValue("C", c(0.837653020601433, 0.839442229716853, 0.841686849937973, 0.988065300395871, 0.980983045380631, 0.837903111763048, 0.987654345864412, 0.987799840016414, 0.983254774112558, 0.838123656373843, 0.986171135434765, 0.98014439695242, 0.982279785486817, 0.842315704511398, 0.986737916365596, 0.836505934825778, 0.988957184271797, 0.987307265478501, 0.988685675718859, 0.989763598918317, 0.985476035978597, 0.989763735236162, 0.839322333158445, 0.840591242238285, 0.840916737626767, 0.840182303257297, 0.989987358356291, 0.993469738285899, 0.986392107466008, 0.994765326978603, 0.839775497604408, 0.984701450461935, 0.841973404171226, 0.840773690867192, 0.992878645332517, 0.839629329117236, 0.984316993729299, 1.00236117636911, 0.987950521070879, 0.986391906363157, 0.990994962092475, 0.841372874295117, 0.840911797347388, 0.840068146397926, 0.841394452262669, 0.986982158584009, 0.840579388281088, 0.838914774103697, 0.994478514771809, 0.990593127008973, 1.0));
	sim.setValue("D", c(0.99629330814284, 0.845582581478907, 0.846283206680254, 0.984581970173985, 0.838717958000366, 1.0, 0.99113733572618, 0.987799839909899, 0.983254709486452, 0.998812102510957, 0.84164815859995, 0.980144400008146, 0.982279780074131, 1.0, 0.84016724304933, 0.983823882438974, 0.994478394528217, 0.990790569459151, 0.992169240445165, 1.00080520434004, 1.0, 0.989763737266105, 0.994982084669168, 0.999999529008015, 1.00067048036403, 0.997505109050316, 0.98998734652225, 0.993469738285093, 0.995395467516996, 0.991281726684917, 0.992631138061233, 0.991667272363189, 0.996516161049541, 0.993357618127106, 0.839475661336771, 0.994825848617739, 0.841169080281629, 0.838947864160612, 0.984467970656165, 0.986391898523055, 0.99796149115757, 1.00203675142425, 0.99627119021144, 0.988429336742394, 0.994982418513155, 0.842284412942455, 1.0, 0.996676185705957, 0.990995339244475, 0.999597010998023, 1.0));
	sim.setValue("E", c(0.992331188927425, 0.84558258154037, 0.846283206621875, 0.984582175858913, 0.845326737201805, 0.992039471249136, 0.987654342876472, 0.991283064849513, 0.983254779089523, 1.0, 0.841672025026086, 0.98362742959951, 0.982279780082858, 0.999999741980104, 0.842320248404744, 0.987307624164335, 0.997961602677251, 0.992828097562842, 0.995652483532062, 0.99528452701026, 0.999407971537389, 0.995284558406418, 1.0, 1.00274595681428, 1.00323746472143, 1.0, 0.996953681442788, 1.00043618555945, 0.991912315704412, 0.991281694146457, 0.996114252481015, 0.991667272361826, 1.00059119085279, 0.999280539809514, 0.985911486937105, 1.0, 0.843184135865656, 0.841091926518046, 0.984467970691793, 0.993357837377733, 0.996515811674037, 1.00203675143018, 1.00211615747079, 0.996995646670014, 0.997690888614009, 0.843912913634543, 0.998991552943775, 0.996005160961101, 0.994478506291811, 1.00264286992908, 1.0));
	sim.setValue("F", c(0.845094282377687, 0.977617608154506, 0.992895711310123, 0.841822081237048, 0.999644914023595, 0.842386040064312, 0.837681049777146, 0.837420398696704, 0.836244291202396, 0.84608020901459, 0.993139146768915, 0.98014439879588, 0.995168670351654, 0.84345002118697, 1.00382953071797, 0.836691141183846, 0.988957187607084, 0.987307269458758, 0.840832041127954, 0.839829422317226, 0.988958653001261, 0.99324703242442, 0.985204099088983, 0.840559894159374, 0.842393345271177, 0.841644243073793, 0.99347051793519, 1.00391936874148, 0.998878538751866, 0.996802945594879, 0.840770267385362, 0.984701450448443, 0.842132147672878, 0.986391785337445, 0.838307587076123, 0.839927036075933, 0.982279519200925, 0.990790200170295, 0.999999943639961, 0.986391906334813, 0.994478291242428, 0.842228615566339, 0.841535751203418, 0.840364529448164, 0.842541518083706, 1.00059118376429, 0.841954103511649, 0.840726549023244, 0.999082992597307, 0.996113829569511, 1.0));
	sim.setValue("G", c(1.0, 0.848050252171236, 0.84890825799177, 0.991548690049957, 0.846532547479986, 0.987110664792249, 0.989691788707288, 0.987799927580335, 1.0, 0.983758217760525, 0.845404336202517, 0.976661247194462, 0.978796645466816, 0.989550308348318, 0.844280139378227, 0.985861983586818, 0.990995240974763, 0.983824116745018, 0.998092362267797, 0.996730182273485, 0.985475507606798, 0.986280516576977, 0.981720930311783, 0.98794966336562, 0.990221000561318, 0.988848001717129, 0.843295242246629, 0.989986584603336, 0.992686839739569, 0.996802959121363, 0.987110457169326, 0.986738496370075, 0.98954981327631, 0.988428854335946, 0.987949842741505, 0.983255201987369, 0.975314011635709, 0.991911655950115, 0.980984994979933, 0.98290874766619, 0.994478319733566, 1.0014448898476, 0.990221103121534, 0.981463291342342, 0.989808504348534, 0.844908055591155, 0.98907159890878, 0.99083122318716, 0.987512227996605, 0.994076337633058, 1.0));
	sim.setValue("H", c(0.987726508370519, 0.845552730681757, 0.845944615804491, 0.836638141717974, 0.984466831756265, 0.98711068110765, 0.987654341751004, 0.993320622789348, 0.837354088301769, 0.981722725503688, 0.83778420238649, 0.980144396635752, 0.998454724602246, 0.991587860353714, 0.84183660031458, 0.983823883348157, 0.99244081333379, 0.987307266428534, 0.992169258146316, 0.996730170159324, 0.99244175564673, 0.993247026038997, 0.988686863622913, 0.987949325562546, 0.988183054526405, 0.984244082538718, 0.993470516940317, 1.00504069363951, 0.996841032033848, 0.991281725652013, 0.990593641308388, 1.0, 0.995070498365178, 0.991911989209021, 0.843377539091547, 0.986738353279552, 0.841242074275772, 0.987306720239538, 0.991433687092224, 0.989874769587216, 0.997961491128422, 0.990994716076874, 0.988183384892652, 0.990466576475795, 0.990724794682157, 0.986982162584434, 0.984468337051302, 0.986226751702243, 1.00077382452274, 1.00104265359106, 1.0));
	sim.setValue("I", c(0.841541910642657, 0.994239867583066, 1.00275341574372, 0.842740062519687, 0.978944833093824, 0.842137422893296, 0.985616747980705, 0.9857623239979, 0.839877315441383, 0.842699118420218, 0.997396944926239, 0.992902948377905, 0.98024229095915, 0.844900792494143, 0.994479275598832, 0.98178658118347, 0.993886549298763, 0.996311272893718, 0.842927860895265, 0.987726081100228, 0.98895857675381, 0.995814034107935, 0.992944616199157, 0.985911742275495, 0.843684047231452, 0.843100228146334, 1.00274603314502, 0.998398672452195, 0.984354596163356, 0.998248582908335, 0.985072863412418, 0.98266394985362, 0.987512127924964, 0.987837046517018, 0.992878646730459, 0.981217990894876, 0.991554985786777, 0.985268394905306, 0.989396048847105, 0.995924725670909, 0.992440754054071, 0.988957201951028, 0.986145878867945, 0.986391582389167, 0.844124687555895, 1.0, 0.843341169419924, 0.841757857848083, 0.997961682995498, 0.988555612444163, 1.0));
	sim.setValue("K", c(0.992331186922123, 0.841797326598267, 0.842497951744018, 0.836565676680878, 0.845356948768592, 0.985073210352685, 0.987654345221444, 1.00521575479831, 0.837330335286967, 0.987241370534099, 0.838997409127559, 0.980144398751917, 0.982279785782649, 0.99855411191358, 0.842090461948377, 0.987307624142877, 0.997045411358855, 0.990790567355978, 1.00025696025817, 0.996730173218127, 0.992441755644044, 1.00181362814675, 0.994982089045136, 0.993470201810956, 1.0002332460888, 0.991209841938635, 0.996953687437036, 1.00391936874433, 0.989874849735709, 0.991281680894105, 0.999999631756408, 0.994479337080297, 1.00243905697001, 0.995395158987685, 0.841124427754674, 0.995742030955776, 0.843084877030728, 0.839178674367554, 0.984468040845445, 1.0, 1.00203650160395, 0.996516041641936, 1.00107277551342, 1.0, 1.0, 0.842234161252134, 0.98998782935343, 0.994314729136194, 0.996516017061085, 0.997559489174518, 1.0));
	sim.setValue("L", c(0.847760038520622, 0.982544923992316, 1.0, 0.847800961435692, 0.980983555267876, 0.848585476341411, 0.982133076723407, 0.985762413419969, 0.977734118754525, 0.84789579682144, 1.0, 0.985073051265034, 0.982279464709221, 0.980547206450742, 1.0, 0.981786949753785, 0.990403404916956, 0.993836485049746, 0.986648569213463, 0.984242933379942, 0.98804231343297, 1.0, 0.987770488712219, 0.985912175373603, 0.982662401796692, 0.978723416639402, 1.0, 1.0, 0.986391643790899, 1.0, 0.987110479471804, 0.982663600179876, 0.984028978868313, 0.993357706489055, 0.985912329349518, 0.981217688961349, 0.986883951306736, 0.98730712850926, 0.990517189830202, 0.990649224727473, 0.995252928910091, 0.98547405020697, 0.986146015093905, 0.986391585827213, 0.979685308789443, 0.996258405880185, 0.97894767722356, 0.980706028894473, 0.997045496600241, 0.993160147832317, 1.0));
	sim.setValue("M", c(0.836214610239895, 0.984582521022777, 0.997824718642601, 0.838629366015239, 0.984465683803963, 0.837129817069448, 0.991137419134551, 0.991282997312685, 0.835338597085256, 0.837206056976968, 1.00445242262861, 0.990593700199944, 0.985762939795602, 0.838692226831161, 0.999999795549371, 0.830820541977567, 0.995923965392826, 0.994273718506879, 0.992168839458544, 0.993246807879963, 0.992441806409077, 1.00481783170679, 0.988687254074119, 0.83487450131556, 0.837295225885095, 0.836871378482098, 1.00043680114457, 1.0024736885071, 0.989875599550716, 1.00633629158031, 0.833671064971314, 0.988184624263166, 0.993032794218547, 0.997962084169976, 0.992878575951207, 0.98673986384516, 0.987800145197234, 0.994273348193239, 0.993471141497842, 0.993357899614011, 1.00144462049847, 0.835929564495613, 0.834881373655347, 0.988429560902194, 0.837570256715662, 0.997432260381745, 0.837269428216127, 0.83557404471267, 1.00144482414875, 0.994076296424458, 1.0));
	sim.setValue("N", c(0.997132757647815, 0.841496582375581, 0.84234330026418, 0.984581970179198, 0.838763207168374, 0.997962348451198, 0.996658064366452, 0.993320622941995, 0.983254700538457, 0.988686986851271, 0.837987275991974, 0.983627430405673, 0.989245815308847, 0.99932872702433, 0.840075497345329, 0.983823886032603, 0.995924061434128, 0.987307265426586, 0.995652484035616, 1.00506300315778, 0.99651672475212, 0.993247026567805, 0.988686881049374, 0.991432763317738, 0.993704107907858, 0.989764205905693, 0.989987349404352, 0.996953009605023, 0.99684103210856, 0.994765325967742, 0.990593641310772, 0.998633489910822, 0.999328293867604, 0.9919119895631, 0.841086833609707, 0.990221447274166, 0.83955608858908, 0.990790205872352, 0.984468040446139, 0.989874769587715, 1.00203650406069, 0.999999211655332, 0.993704189828961, 0.98842933672719, 0.994982436946336, 0.840846002578949, 0.994916546754088, 0.994314729136037, 0.999999177594389, 0.996113829570823, 1.0));
	sim.setValue("P", c(0.980761161539218, 0.843555256048772, 0.843980582231168, 0.984582432934756, 0.847444155243725, 0.978107226025218, 0.987654432997459, 0.984316698876362, 0.979771639117382, 0.978238199603419, 0.840731763845075, 0.976661245287081, 0.840954574587569, 0.98258464860896, 0.843409893547358, 1.0, 0.990995242410914, 1.0, 0.985202528026097, 0.986280448089242, 0.981992887183783, 0.986280587638022, 0.981720928260259, 1.0, 1.0, 0.980760930086505, 0.986504199791087, 0.989986584603656, 0.988429131253054, 0.98779857084922, 1.0, 0.981218327794907, 0.986066490931952, 0.982908445903573, 0.982427767478992, 0.841925376018147, 0.975314011638636, 0.983823291821659, 0.980984994911682, 0.98290874765269, 1.0, 0.994478617615693, 0.988183531777846, 0.981463293359424, 0.981722694621405, 0.843747761008208, 0.987950285450534, 1.0, 0.987512192144965, 0.99059316898025, 1.0));
	sim.setValue("Q", c(0.989764213629956, 0.845522700565626, 0.84591266680802, 0.9845821781249, 0.839977054748498, 0.985073211841989, 0.987654344283648, 0.998249434645265, 0.838804332987434, 0.990724446646237, 0.986171345669984, 0.983627429592151, 0.987800168472147, 0.9971084736324, 0.845282766726911, 0.987307601382543, 0.995924061624673, 0.992828097280944, 0.99769000705353, 0.995284527004989, 0.993562961864677, 1.00080522257401, 0.996244967418855, 0.993470530126979, 0.997961943810925, 0.994021972731619, 0.998074973152052, 1.00324836095189, 0.989874850166368, 0.996802946316613, 0.996114242341982, 0.996750608232585, 0.999999314902217, 1.0, 0.841379957824545, 0.997187670263823, 0.84325730791206, 0.987306728345193, 0.984468075768858, 0.99539534842249, 1.00077357791391, 0.999083031584841, 0.999754367530639, 0.998878532837526, 0.997690888606424, 0.98698214348893, 0.991433447460373, 0.991747434771205, 0.999082986049189, 1.00163453500824, 1.0));
	sim.setValue("R", c(0.984243547463653, 0.848866479175594, 0.849567104358864, 0.979062103838081, 0.848444260918017, 0.976069852487774, 0.982133076737023, 1.0, 0.841766851262093, 0.97620174195167, 0.84447010393858, 0.974623731526984, 0.982279464820739, 0.989550328704323, 0.847918576932183, 0.981786949721138, 0.990403376676013, 0.985269902123514, 0.995652464851068, 0.989763846984188, 0.985475428627604, 0.996730206388972, 0.986649262408904, 0.982428627083451, 0.988183435256193, 0.98424354036126, 0.991432983903796, 0.999998975141342, 0.984354185173799, 0.989244662413352, 0.993639493372021, 0.990751004920728, 0.995070526300394, 0.990649078255146, 0.844271214980149, 0.986738382950462, 0.844132463516758, 0.981785836671269, 0.97894743561443, 0.993759990981155, 0.995252933288619, 0.988957892127695, 0.993112324051515, 0.993357877985973, 0.99294497479048, 0.981461541138325, 0.98242979461126, 0.986226787198537, 0.992440994623393, 0.995521988826715, 1.0));
	sim.setValue("S", c(0.986810553995211, 0.845618168921526, 0.846424061064946, 0.996153208922101, 0.847286947635548, 0.985073166460747, 1.0, 0.987800070169491, 0.988183847477434, 0.981720705096041, 0.980651669107817, 0.982711206642685, 0.980242010598266, 0.990324931795509, 0.844382909767089, 0.988753343284379, 0.996326340498665, 0.988753096333986, 0.996427205876899, 1.0, 0.988042325137017, 0.989763892548942, 0.985203655819165, 0.991432849842913, 0.990750451982461, 0.988501303208406, 0.984466692734627, 0.991432344918184, 0.99292062529448, 0.996803017557991, 0.990593553175622, 0.988184057167594, 0.996918399302986, 0.988958277404241, 0.990170122224301, 0.983255151590037, 0.976758853927676, 0.996582743853106, 0.984467323440652, 0.986391565154085, 0.996515805330893, 1.0, 0.993112334557691, 0.984945915322828, 0.988687164405323, 0.981461538118558, 0.991835610411943, 0.993595338777546, 0.996516043580089, 0.994076347928535, 1.0));
	sim.setValue("T", c(0.980761161532197, 0.977616206265031, 0.983891950214523, 0.990877683186871, 0.848882565621727, 0.98158995038015, 1.00189157092026, 0.989837459606137, 0.979771637135514, 0.981720771124664, 0.986172706732901, 0.991185587853995, 0.978796645186127, 0.989550308849084, 0.983254524878532, 0.987307628422954, 0.998736259705793, 0.992828084157198, 0.993290670462804, 0.997851496010604, 0.990079885398604, 0.993247057551128, 0.992761824492962, 0.989987202146834, 0.990221000560176, 0.987726688434068, 0.993470543819004, 0.995507389633662, 0.989874719835956, 0.998840535384387, 0.991714906387091, 0.986738496629239, 1.0, 0.989874476399814, 0.994916145485836, 0.986738289176554, 0.982279463870601, 0.994865401347511, 0.984467371272633, 0.994958037168102, 0.996515831782677, 0.997290701557875, 0.993704252217276, 0.98955052189893, 0.987241643281331, 0.989020285670674, 0.992025267407859, 0.991747392999468, 1.0, 0.99519765809372, 1.0));
	sim.setValue("V", c(0.842384378417452, 0.84153685109193, 0.841819405541449, 0.842958165620786, 0.984467136647426, 0.843375806593883, 0.841530248794832, 0.841791124191745, 0.839113710005978, 0.843189819759885, 0.840526456391597, 0.842217722909759, 0.984317017316501, 0.846082736388262, 0.986738110265713, 0.839779339326904, 0.844055975152173, 0.842313692414068, 0.844913440461659, 0.843507956283765, 0.843653617128264, 0.986280670865938, 0.843715831944094, 0.843389321172691, 0.844592714702486, 0.84367938722587, 0.98650419981196, 0.995507389636578, 0.986391721040983, 0.987798570871244, 0.843016115098497, 0.843591085143524, 0.845140047609077, 0.844707854215456, 0.841871045961656, 0.842226218635344, 0.841557968789363, 0.983823291810455, 0.992026398646802, 0.84507326117461, 0.846161456024784, 0.844529233163846, 0.843878781226834, 0.844041564394425, 0.84533959702403, 0.986982696831217, 0.844261876390344, 0.842919954816912, 0.987512224020881, 0.990593168980509, 1.0));
	sim.setValue("W", c(0.834214385036587, 1.0, 1.00591224150903, 0.993586200594077, 0.984465683802561, 0.835625734117372, 0.994620018151918, 0.991282997329138, 0.986737928938142, 0.985204488974223, 0.999434414013808, 1.0, 0.985762940557935, 0.989550950940343, 0.997187684705978, 0.99282828750215, 1.0034822774219, 1.00405220137697, 0.992168839460785, 0.993246807438714, 0.995924847031215, 1.00021335465136, 1.00157596787568, 0.996953523515852, 0.991666221613324, 0.991209911827388, 1.00799505286652, 1.00504065208629, 0.993358030337624, 1.00580683880431, 0.994076759951823, 0.988184624181175, 0.996516116637213, 0.995395154056174, 1.00576818804343, 0.990221505138588, 1.0, 0.999794155380315, 0.996037438629073, 1.00313622026435, 0.997961417794709, 0.994477877180021, 0.995149829518841, 0.993949728124961, 0.98868896071949, 1.00551997155671, 0.98795149873329, 0.989710178142733, 1.0049279932574, 1.0010426409603, 1.0));
	sim.setValue("X", c(0.834214385036587, 0.839442229716853, 0.841686849937973, 0.836565676680878, 0.838717958000366, 0.835625734117372, 0.837681049777146, 0.837420398696704, 0.835338597085256, 0.837206056976968, 0.83778420238649, 0.842217722909759, 0.840954574587569, 0.838692226831161, 0.840075497345329, 0.830820541977567, 0.844055975152173, 0.842313692414068, 0.840832041127954, 0.839829422317226, 0.843653617128264, 0.986280516576977, 0.839322333158445, 0.83487450131556, 0.837295225885095, 0.836871378482098, 0.843295242246629, 0.989986584603336, 0.984354185173799, 0.98779857084922, 0.833671064971314, 0.843591085143524, 0.841973404171226, 0.840773690867192, 0.838307587076123, 0.839629329117236, 0.83955608858908, 0.838947864160612, 0.97894743561443, 0.84507326117461, 0.846161456024784, 0.835929564495613, 0.834881373655347, 0.840068146397926, 0.837570256715662, 0.840846002578949, 0.837269428216127, 0.83557404471267, 0.987512192144965, 0.988555612444163, 1.0));
	sim.setValue("Y", c(0.837653020601688, 0.845582581518341, 0.846162718954363, 0.838407107199413, 1.0, 0.981590589955009, 0.838131180536272, 0.9877998401317, 0.837258391600057, 0.838357617180516, 0.986171135427254, 0.98014439553057, 1.0, 0.842703959193335, 0.994825781931563, 0.837825007787084, 0.98895718428009, 0.987307274443544, 0.988685676693461, 0.989763597871822, 0.990996094307963, 0.989763744380628, 0.985204098065438, 0.841580370946186, 0.841761437566577, 0.841072902604755, 0.989987354176609, 1.00551964083325, 1.0, 0.991281721519126, 0.840972315079466, 0.991667241036975, 0.843017645726352, 0.986391785329348, 0.843244520348544, 0.840525575903532, 0.978797174019698, 0.990790205953292, 1.0, 0.986391899542687, 0.99447829165327, 0.842501907641274, 0.842090409007966, 0.984946385301154, 0.842337408109909, 0.997432297436427, 0.84106168961129, 0.839915249884133, 0.999999221540638, 0.998680812599533, 1.0));

	sim.setValue("fitness_profiles0",c(49, 32, 7, 39, 11, 37, 32, 13, 22, 46, 13, 12, 23, 11, 19, 26, 34, 26, 36, 32, 42, 15, 43, 44, 26, 15, 29, 31, 29, 42, 7, 10, 21, 7, 46, 44, 18, 32, 39, 34, 35, 29, 7, 16, 0, 1, 16, 11, 20, 34, 39, 23, 32, 44, 34, 28, 8, 28, 19, 27, 19, 27, 13, 41, 7, 17, 17, 31, 2, 37, 36, 47, 15, 37, 16, 30, 48, 0, 14, 6, 15, 41, 41, 39, 23, 6, 22, 48, 18, 41, 30, 4, 10, 47, 37, 11, 0, 30, 33, 28, 27, 5, 29, 17, 15, 22, 44, 23, 8, 16, 16, 18, 37, 23, 15, 5, 20, 3, 13, 32, 15, 21, 27, 5, 32, 14, 20, 6, 47, 27, 38, 8, 45, 26, 25, 23, 23, 30, 11, 3, 0, 23, 41, 45, 34, 37, 12, 42, 35, 6, 45, 27, 30, 31, 39, 39, 0, 28, 43, 22, 34, 23, 16, 7, 8, 37, 24, 27, 47, 35, 42, 44, 26, 25, 43, 7, 39, 11, 23, 37, 23, 29, 35, 8, 43, 36, 13, 17, 12, 0, 46, 22, 44, 40, 23, 7, 19, 24, 18, 43, 19, 17, 1, 8, 37, 47, 24, 32, 11, 14, 17, 31, 21, 28, 23, 45, 40, 43, 17, 15, 16, 15, 18, 42, 47, 17, 40, 5, 23, 14, 11, 7, 7, 28, 34, 23, 1, 43, 24, 4, 17, 41, 11, 4, 8, 12, 42, 11, 11, 23, 22, 5, 33, 12, 10, 48, 37, 33, 48, 38, 7, 13, 12, 18, 28, 4, 14, 0, 14, 8, 17, 42, 21, 47, 23, 34, 22, 34, 4, 24, 20, 11, 27, 5, 26, 21, 2, 22, 0, 42, 48, 13, 42, 9, 31, 29, 30, 46, 46, 49));
	defineConstant("start_stop_codon_positions",matrix(c(0, 897), ncol = 2, byrow = T));

	defineConstant("seq_length", 900);
	get_fitness();

	sim.setValue("fixations_p1", sim.chromosome.ancestralNucleotides(format = "integer"));
	sim.setValue("fixations_counted_p1", 0);
	sim.setValue("dN_p1", 0);
	sim.setValue("dS_p1", 0);
	sim.setValue("subs_p1", "\n\nSubstitutions:");
}


function (void) get_fitness (void){
	poses = start_stop_codon_positions;

	for (row_num in (0:(nrow(start_stop_codon_positions)-1))){
		fitnesses = c();
		aas = codonsToAminoAcids(sim.chromosome.ancestralNucleotides(drop(poses[row_num,0]), drop(poses[row_num, 1])+2, "codon"), paste = F);

		sim.setValue("ancestral_aa_seq" + asString(row_num),aas); 

		count = 0;
		for (aa in aas){
			fitnesses = c(fitnesses, sim.getValue(aa)[sim.getValue("fitness_profiles" + row_num)[count]]);
			count = count + 1; 
		}

		sim.setValue("ancestral_fitnesses" + asString(row_num), fitnesses);
		sim.setValue("ancestral_fitness_value" + asString(row_num), sum(fitnesses));
		sim.setValue("ancestral_aas" + asString(row_num), aas);

	}
}


function (float) get_genome_fitness (object nucs){
	fitness_value = 0.0;
	for (row_num in (0:(nrow(start_stop_codon_positions) -1))){

		anc_fit_val =  sim.getValue("ancestral_fitness_value" + asString(row_num));

		starting_pos = drop(start_stop_codon_positions[row_num,0]);
		ending_pos = drop(start_stop_codon_positions[row_num,1])+2;
		aa_stop_pos = (ending_pos - starting_pos + 1)/3 - 1;
		aa_seq = codonsToAminoAcids(nucs.nucleotides(start = starting_pos, end = ending_pos, format = "codon"), paste = F);

		poses = (aa_seq != sim.getValue("ancestral_aas" + row_num));

		if(sum(poses) == 0){
			codon_fit = anc_fit_val;
		}
		else if(any(poses[0] | poses[aa_stop_pos])){
			codon_fit = 0;
		}
		else{
		fitness_vals = sim.getValue("ancestral_fitnesses"+row_num);
			fitness_vals[poses] = sapply(which(poses), "sim.getValue(aa_seq[applyValue])[sim.getValue(\"fitness_profiles\" + row_num)[applyValue + starting_pos]];");

			if(any(aa_seq[poses] == "X")){
				early_stop_point = which(aa_seq[poses] == "X")[0];
				fitness_vals = fitness_vals[starting_pos:early_stop_point];
			}

			codon_fit = sum(fitness_vals);
		}

		fitness_value = fitness_value + codon_fit;
	}

	return fitness_value;
}


fitnessEffect() {return((get_genome_fitness(individual.genome1)+get_genome_fitness(individual.genome2)) / 595.843601190247);//If error says total fitness < 0.0, mutation rate is lethal
}


1500 late() {
	setup_fitness();
	sim.readFromPopulationFile("p3.txt");
	p1.setSubpopulationSize(100);

	sim.setValue("fixations_p1", codonsToNucleotides(nucleotidesToCodons(readFile("p3_fixed_mutations.txt")), format = "integer"));
	sim.setValue("fixations_counted_p1", 0);
	sim.setValue("dN_p1", 0);
	sim.setValue("dS_p1", 0);
	sim.setValue("subs_p1", "\n\nSubstitutions:");
}


1500:1500late () {
	if(length(sim.mutations)!= 0){
		ancestral_genome = sim.getValue("fixations_p1");
		row_num = p1.individualCount* 2;
		muts_mat = integer(row_num*1500);
		muts_mat = p1.genomes.nucleotides(NULL, NULL, "integer");
		muts_mat = matrix(muts_mat, nrow = row_num, byrow = T);
		compare_seq = c(muts_mat[0,]);

		fixed_nucs = apply(muts_mat, 1, "max(applyValue) - min (applyValue) == 0;");

		different_muts = (ancestral_genome != compare_seq);
		new_fixations = different_muts & fixed_nucs;

		if(any(new_fixations)){
			new_fixed = ancestral_genome;
			new_fixed[new_fixations] = compare_seq[new_fixations];

			sim.setValue("fixations_counted_p1", sim.getValue("fixations_counted_p1") + sum(new_fixations));
			ancestral_genome = new_fixed;
			sim.setValue("fixations_p1", ancestral_genome);
		};
	};
}


1501 late() {
	genomes = p1.genomes;

	for (g in genomes){
		fasta_string_nuc = "";
		fasta_string_nuc = paste0(">", g.individual, ", p5: \n", g.nucleotides());
		writeFile("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_MBE/EX_14/nuc_FASTA/p5_nuc.fasta", fasta_string_nuc,append = T);
		fasta_string_prot = paste0(">", g.individual, ", p5: \n", codonsToAminoAcids(nucleotidesToCodons(g.nucleotides())));
		writeFile("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_MBE/EX_14/aa_FASTA/p5_aa.fasta", fasta_string_prot,append = T);}
	writeFile("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_MBE/EX_14/p5_fixed_mutations.txt", paste(codonsToNucleotides(nucleotidesToCodons(sim.getValue("fixations_p1"))), sep = ""));
	writeFile("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_MBE/EX_14/p5_fixed_mutation_counts.txt",asString(sim.getValue("fixations_counted_p1")));
	sim.outputFixedMutations();
}