initialize() {
	setSeed(810175596);
	initializeSLiMOptions(nucleotideBased=T);
	initializeAncestralNucleotides("p1.fasta");
	mm = mmJukesCantor(0.0005);
	initializeMutationTypeNuc("m1", 0.5, "f", 0.0);
	m1.convertToSubstitution = F;
	initializeGenomicElementType("g1", m1, 1.0, mm);
	initializeGenomicElementType("g2", m1, 1.0, mm);
	initializeRecombinationRate(2.5e-08);
	initializeGenomicElement(g1, 0, 899);
}


function (void) setup_fitness(void){
	sim.setValue("A", c(0.987726697002914, 0.977616164629395, 0.983891067973007, 1.0, 0.848840724395207, 0.981590114607551, 0.994620519264738, 0.989837424593256, 0.996333912234816, 0.987241371126429, 0.986172654070067, 0.985665079135574, 0.982279476762475, 0.991587658140999, 0.98325449956009, 0.994578643814903, 1.0, 0.995395051245473, 1.0, 0.996059150741212, 0.990080183425421, 0.994368373911212, 0.993291247716665, 0.999262691094511, 0.994478767723347, 0.995814223821733, 0.993470497044105, 0.996953008270665, 0.994479124476237, 1.00173205553549, 0.995676943765652, 0.988184156070028, 0.995845153844838, 0.994957888151684, 1.0, 0.990221216149782, 0.988921498847054, 1.0, 0.989070952813028, 0.990995767195916, 0.997290546358646, 1.00174951051439, 1.0, 0.991241206794316, 0.992761953834574, 0.990465930810146, 0.991433407004881, 0.994793267557565, 0.996515858662707, 1.0, 1.0));
	sim.setValue("C", c(0.837653020600952, 0.839442229698759, 0.841686849904925, 0.988065565174946, 0.980983048769501, 0.837903111762214, 0.987654177126328, 0.987799696279983, 0.983254774166479, 0.83812365637649, 0.986171045660813, 0.980144828799828, 0.98227974522404, 0.842315704516753, 0.986738160057529, 0.836505934824318, 0.988957203124369, 0.987307151270026, 0.988686163412148, 0.989763560118909, 0.985476796199298, 0.989763699846518, 0.839322333149262, 0.840591242220769, 0.840916737630465, 0.840182303259914, 0.989987255563771, 0.9934697111674, 0.98639201477289, 0.994765686828847, 0.839775497603613, 0.984701654520724, 0.841973404185175, 0.840773690887687, 0.992878612969347, 0.839629329108983, 0.984317030986915, 1.00236120823881, 0.987950306377039, 0.986391468086968, 0.990995107074489, 0.841372874288417, 0.840911797341074, 0.840068146394994, 0.841394452255712, 0.986982051681398, 0.840579388281627, 0.838914774106506, 0.994478277224315, 0.990593127028041, 1.0));
	sim.setValue("D", c(0.996293296524039, 0.845582581473911, 0.846283206722939, 0.984582016646474, 0.838717957990266, 1.0, 0.991137421598479, 0.987799696478328, 0.983254709588241, 0.998812097381644, 0.841648158558239, 0.98014482134889, 0.982280186273354, 1.0, 0.840167243073804, 0.983824144594874, 0.994478402455583, 0.99079052775561, 0.992169504799753, 1.00080519634331, 1.0, 0.989763701894664, 0.994982065075481, 0.999999425721922, 1.00067052267193, 0.997505040035359, 0.98998724178136, 0.993469711173895, 0.995395432689491, 0.991282249298362, 0.992631074044952, 0.99166732181194, 0.996516159299997, 0.993357582762729, 0.839475661331308, 0.994825850289364, 0.841169080300452, 0.838947864161109, 0.984467632725005, 0.986391459846148, 0.997961563804286, 1.00203672841058, 0.996271166721391, 0.988429303087304, 0.994982180626475, 0.84228441293331, 1.0, 0.996676141371304, 0.990994974904006, 0.999597011014126, 1.0));
	sim.setValue("E", c(0.992331154633371, 0.845582581665932, 0.84628320675557, 0.984582213227996, 0.845326737198726, 0.992039798056886, 0.987654174067487, 0.991283016070659, 0.983254779141552, 1.0, 0.841672025020207, 0.983627681812021, 0.982280186295118, 0.999999547891696, 0.84232024849323, 0.987307658987406, 0.997961609625962, 0.992828169090178, 0.995652712833033, 0.995284496751855, 0.999408223163429, 0.995284543957918, 1.0, 1.00274584290412, 1.00323750206539, 1.0, 0.996953641134559, 1.00043616637867, 0.991912234534756, 0.991282291147458, 0.996114207379953, 0.991667321879244, 1.00059121638614, 0.999280482954135, 0.985911209338665, 1.0, 0.843184135896933, 0.841091926516696, 0.984467658378225, 0.993357608748554, 0.996515895044842, 1.00203672846488, 1.00211618076141, 0.996995607248283, 0.997690619665551, 0.843912913643915, 0.998991573720531, 0.996005141742695, 0.994478268764448, 1.0026428699301, 1.0));
	sim.setValue("F", c(0.845094282377583, 0.977617444986156, 0.992895676299858, 0.841822081245653, 0.999644914471694, 0.84238604007103, 0.837681049779115, 0.837420398697593, 0.836244291209474, 0.846080209015277, 0.993139097498765, 0.980144827608031, 0.995168638570322, 0.843450021177818, 1.00382939140376, 0.836691141191649, 0.988957206080706, 0.987307154924317, 0.840832041134712, 0.839829422323288, 0.988959015138284, 0.993246997062128, 0.985204083554661, 0.84055989416506, 0.842393345273414, 0.841644243075572, 0.993470463185301, 1.00391936336639, 0.998878467089254, 0.996803239010138, 0.840770267388325, 0.984701654541771, 0.842132147669152, 0.986391707156128, 0.838307587072434, 0.839927036071516, 0.982279650239089, 0.990790243969415, 0.999999764641191, 0.986391468148743, 0.994478392328671, 0.842228615562505, 0.841535751197143, 0.840364529452391, 0.842541518076077, 1.00059105266744, 0.841954103512172, 0.840726549023409, 0.999082805648916, 0.996113829610812, 1.0));
	sim.setValue("G", c(1.0, 0.848050252137524, 0.84890825798094, 0.99154868261552, 0.846532547479878, 0.98711065719112, 0.98969183293181, 0.987799878757258, 1.0, 0.983758208705436, 0.845404336180098, 0.976661672571855, 0.978796588022772, 0.98955016424173, 0.844280139398344, 0.985862011217136, 0.990995249088381, 0.983824005130546, 0.998092526856063, 0.99673016736537, 0.985475867872866, 0.986280482688223, 0.981720914902265, 0.987949493041747, 0.990221043740694, 0.988847883984809, 0.843295242238123, 0.989986557404871, 0.992686777903691, 0.996803255874952, 0.9871103644826, 0.986738576624995, 0.989549809348028, 0.988428810689424, 0.987949804586102, 0.983255204088304, 0.975314113586203, 0.991911684804222, 0.980984603140802, 0.98290852508832, 0.99447838640798, 1.00144486236101, 0.990221088860212, 0.981463383536289, 0.989808249299367, 0.844908055613148, 0.989071605338457, 0.990831154444221, 0.987511858166105, 0.994076337693946, 1.0));
	sim.setValue("H", c(0.98772640807616, 0.845552730690297, 0.845944615827018, 0.83663814172019, 0.984466817689194, 0.987110698984672, 0.987654173078543, 0.993320595100728, 0.837354088300993, 0.981723099833921, 0.83778420238742, 0.980144830021255, 0.998454726685666, 0.991587654819436, 0.841836600315122, 0.98382414633333, 0.992440822604721, 0.987307154939569, 0.992169522421848, 0.996730154726811, 0.992441992399849, 0.993246991721092, 0.988686860040271, 0.98794885594493, 0.988183222857494, 0.984243531936603, 0.993470462188656, 1.00504068517038, 0.996840950890445, 0.99128224981789, 0.990593505470493, 1.0, 0.995070524645169, 0.991911939635446, 0.843377539076098, 0.986738355389596, 0.841242074284459, 0.987306823903119, 0.991433510016919, 0.989874658920693, 0.997961563784716, 0.990994578819437, 0.988183344175052, 0.99046663675064, 0.990724508997474, 0.986982055668959, 0.984468512362885, 0.986226792028359, 1.0007736345586, 1.00104265360006, 1.0));
	sim.setValue("I", c(0.84154191064605, 0.994239862420645, 1.00275336274913, 0.842740062521412, 0.9789448324177, 0.842137422884164, 0.98561663528636, 0.98576219190092, 0.839877315441719, 0.842699118424453, 0.997396776195424, 0.992903095215317, 0.980242238312109, 0.844900792491479, 0.99447927055522, 0.981786728088376, 0.993886556755598, 0.996311216211822, 0.842927860899157, 0.987726046388244, 0.988958889031598, 0.995814018765701, 0.992944584887658, 0.985911276580046, 0.843684047232088, 0.843100228151295, 1.00274601843336, 0.998398652630265, 0.984354501147284, 0.99824889469883, 0.985072452703885, 0.982664093250325, 0.987512153132955, 0.987836992874976, 0.992878625280355, 0.981217997569579, 0.991555071461284, 0.985268502774712, 0.989395888968677, 0.995924568622352, 0.992440855348497, 0.988957065655649, 0.986145837917024, 0.986391680613862, 0.844124687557438, 1.0, 0.843341169431094, 0.841757857841535, 0.997961494480437, 0.988555612447242, 1.0));
	sim.setValue("K", c(0.992331152611605, 0.841797326574068, 0.84249795176628, 0.836565676680632, 0.84535694874753, 0.985073234967691, 0.987654177907709, 1.00521571786091, 0.837330335290555, 0.98724136163885, 0.83899740913034, 0.980144826451051, 0.982279732237043, 0.998553912461047, 0.842090461957405, 0.987307659036691, 0.997045418460099, 0.990790513976895, 1.00025713148886, 0.996730157676779, 0.992441992399318, 1.00181361317973, 0.994982069476483, 0.993470061267573, 1.00023329188302, 0.991209712428577, 0.996953647096928, 1.00391936336662, 0.98987477572117, 0.991282278031113, 0.999999617979616, 0.994479395876541, 1.00243908418846, 0.995395172382458, 0.841124427763233, 0.995742033092825, 0.843084877051065, 0.839178674371929, 0.984468049458387, 1.0, 1.00203658606215, 0.996515998721553, 1.00107276139927, 1.0, 1.0, 0.842234161254011, 0.989987849280571, 0.994314326980431, 0.996515803400253, 0.997559489177123, 1.0));
	sim.setValue("L", c(0.847760038535698, 0.982544915722591, 1.0, 0.847800961434632, 0.980983555429373, 0.848585476341541, 0.982133459962738, 0.985762363900651, 0.977734118883592, 0.847895796833912, 1.0, 0.985073183029771, 0.982279460117007, 0.980546566716977, 1.0, 0.98178697098329, 0.990403412526316, 0.993836448218452, 0.986648830878433, 0.984242896138715, 0.988042595655987, 1.0, 0.987770536751416, 0.985912005053898, 0.98266255907696, 0.978722866267932, 1.0, 1.0, 0.986391573682953, 1.0, 0.987110412373799, 0.982663683102453, 0.984029002873067, 0.99335762185177, 0.985912291145693, 0.981217691066976, 0.986884071399537, 0.987307164400205, 0.990517045361822, 0.990649053130023, 0.99525303492013, 0.985473913994255, 0.9861460006303, 0.986391591508588, 0.979684312051505, 0.996258455281716, 0.978947853323562, 0.980705997205828, 0.997045312440133, 0.993160147808111, 1.0));
	sim.setValue("M", c(0.836214610239881, 0.984582513391269, 0.997824656917514, 0.838629366014872, 0.984465683850682, 0.837129817065858, 0.991137362051573, 0.991282818708411, 0.835338597084704, 0.837206056988676, 1.00445268587788, 0.99059388286425, 0.985762893122202, 0.838692226830708, 0.999999719753476, 0.830820541977203, 0.995923974768928, 0.994273661862403, 0.992169356639645, 0.993246712680092, 0.992442168027656, 1.00481781728824, 0.988687238608151, 0.834874501314598, 0.837295225884332, 0.836871378482087, 1.00043675674522, 1.00247366146301, 0.989875176977912, 1.00633658599571, 0.833671064971029, 0.988184765949047, 0.993032818349968, 0.99796199373038, 0.992878526778094, 0.986739876318469, 0.987800166377569, 0.994273391168174, 0.993470987675309, 0.993357642942404, 1.00144468690695, 0.835929564494643, 0.834881373656676, 0.988429653668628, 0.837570256716978, 0.997432233880715, 0.837269428217986, 0.835574044714891, 1.00144458886523, 0.994076296410252, 1.0));
	sim.setValue("N", c(0.997132772870043, 0.841496582371809, 0.842343300261516, 0.984582016629495, 0.838763207164275, 0.997962343626178, 0.996658134003531, 0.993320595729856, 0.983254700631561, 0.98868697739693, 0.837987275999512, 0.983627641645773, 0.989245844294975, 0.999328530836302, 0.840075497346699, 0.983824147671501, 0.995924068753614, 0.987307155679571, 0.995652713334217, 1.00506299045514, 0.996516982424061, 0.993246992226929, 0.98868687745602, 0.991432592989399, 0.993704151072183, 0.989764077637973, 0.989987244840558, 0.9969529878742, 0.996840950865113, 0.994765685860919, 0.99059350547772, 0.998633541425628, 0.999328305758416, 0.991911940031019, 0.841086833612002, 0.990221449377584, 0.839556088607296, 0.990790243087002, 0.984468049449869, 0.989874659002179, 1.00203658344472, 0.999999163800578, 0.993704176042824, 0.988429303089392, 0.99498219929371, 0.840846002568504, 0.994916557675949, 0.994314326982537, 0.999998989100667, 0.996113829611234, 1.0));
	sim.setValue("P", c(0.980760428085864, 0.843555256053692, 0.843980582343544, 0.984582363709273, 0.847444155260637, 0.978107505708518, 0.987654265522504, 0.98431652537426, 0.979771640459152, 0.978237605288416, 0.840731763846579, 0.976661676063384, 0.840954574581512, 0.98258406615187, 0.843409893659597, 1.0, 0.990995250447063, 1.0, 0.985203013062735, 0.986280409294205, 0.981993571727707, 0.986280553740861, 0.981720912862455, 1.0, 1.0, 0.980760378335402, 0.986504099207682, 0.989986557405181, 0.988429078684956, 0.987799168024024, 1.0, 0.981218467641851, 0.9860665150042, 0.982908516632281, 0.982427292890347, 0.841925376019369, 0.975314113582633, 0.983823390769856, 0.980984603294354, 0.982908526439435, 1.0, 0.994478575061354, 0.988183516797051, 0.981463385651925, 0.98172164960273, 0.843747761001827, 0.987950300514394, 1.0, 0.987511822331316, 0.99059316900246, 1.0));
	sim.setValue("Q", c(0.989764155135028, 0.845522700526558, 0.845912666823217, 0.984582215282263, 0.839977054738345, 0.985073236458883, 0.987654176887968, 0.998249383547795, 0.838804332989445, 0.990724414887538, 0.986171263035404, 0.983627681812507, 0.987800159533997, 0.997108258949543, 0.845282766723393, 0.987307636977353, 0.995924069001646, 0.992828169088742, 0.997690188230429, 0.995284496750383, 0.993563244430242, 1.0008052043758, 0.996244948612216, 0.993470389585949, 0.997961974396546, 0.994021845212337, 0.998074931485447, 1.00324835839037, 0.989874774327011, 0.996803240819834, 0.996114203187414, 0.996750663101973, 0.999999338128752, 1.0, 0.841379957831583, 0.997187672162465, 0.843257307922888, 0.987306832064514, 0.984467694070282, 0.995395121890788, 1.00077369552511, 0.999082986124396, 0.999754356192179, 0.998878522282196, 0.997690619668315, 0.986982036579939, 0.991433452155196, 0.99174733176923, 0.999082799083674, 1.0016345350121, 1.0));
	sim.setValue("R", c(0.984243490362112, 0.848866479131047, 0.849567104416049, 0.97906135907287, 0.848444260928449, 0.976070107160806, 0.982133459942866, 1.0, 0.841766851261959, 0.976201794334158, 0.844470103962997, 0.974624161563189, 0.982279457027136, 0.989550005327598, 0.847918576950832, 0.981786970921265, 0.990403384347661, 0.985269844264963, 0.995652634999504, 0.989763834993898, 0.985475739317853, 0.996730191188972, 0.986649264410508, 0.982428159039549, 0.988183478430456, 0.984243411590183, 0.991432940806231, 0.999998964754043, 0.984354114179914, 0.989245021771976, 0.993639448899282, 0.990751060151754, 0.995070551827149, 0.990649065535129, 0.844271214965427, 0.986738382678519, 0.844132463552359, 0.981785930512164, 0.978947047650039, 0.993759824910375, 0.995253031920902, 0.988957854431117, 0.993112345157933, 0.993357853498357, 0.992944763471388, 0.98146148473759, 0.982429788558728, 0.986226668700925, 0.992440755945752, 0.995521988829075, 1.0));
	sim.setValue("S", c(0.986810488405089, 0.84561816897303, 0.846424061043337, 0.996153207111767, 0.847286947635206, 0.985073124375579, 1.0, 0.987799970121528, 0.988183847545043, 0.98172069612575, 0.980650786239959, 0.982711376312124, 0.980241988361372, 0.990324709000574, 0.844382909886578, 0.98875336570365, 0.996326347186327, 0.988753038524714, 0.996427391473655, 1.0, 0.988042607354088, 0.989763878310041, 0.985203654332084, 0.991432730031042, 0.990750488302999, 0.988501175507904, 0.98446658673407, 0.991432323074409, 0.99292055092483, 0.996803315506685, 0.990593506255421, 0.988184116678657, 0.996918404572068, 0.988958294006547, 0.99017010283357, 0.983255153071621, 0.976758975696565, 0.996582776206644, 0.984467140990008, 0.986391315394264, 0.996515926574736, 1.0, 0.993112355815165, 0.984945975811573, 0.988686919149721, 0.981461481725266, 0.991835620064089, 0.993595208282047, 0.996515859241443, 0.994076347939123, 1.0));
	sim.setValue("T", c(0.980760428072145, 0.977616197462542, 0.983891067698422, 0.99087768749551, 0.848882565614274, 0.981590089732205, 1.001891653349, 0.9898374245682, 0.979771638473771, 0.981720760341432, 0.986172653282351, 0.991185739202874, 0.978796592269614, 0.989550164583297, 0.983254477412748, 0.987307654259919, 0.998736266178362, 0.992828059235412, 0.993290830832506, 0.997851479851318, 0.990080181083656, 0.993247041782566, 0.992761805812978, 0.989987061570534, 0.990221043742588, 0.987726560931941, 0.9934704990418, 0.995507366212736, 0.989874610035954, 0.99884082848417, 0.991714809488766, 0.986738577316803, 1.0, 0.989874439883087, 0.994916061133135, 0.986738289125832, 0.982279483834126, 0.994865449394766, 0.984467175205612, 0.994957875696811, 0.996515915905445, 0.997290653616657, 0.993704205344319, 0.989550417122238, 0.987241351399778, 0.989020254187852, 0.992025279099291, 0.991747345997068, 1.0, 0.995197658067104, 1.0));
	sim.setValue("V", c(0.842384378427678, 0.841536851148373, 0.841819405562859, 0.842958165629885, 0.984467147795084, 0.843375806581129, 0.841530248784963, 0.841791124227616, 0.83911371000591, 0.843189819764259, 0.840526456411437, 0.842217722898904, 0.98431699183433, 0.846082736364034, 0.986738181593882, 0.839779339332007, 0.844055975136899, 0.842313692439437, 0.844913440457747, 0.84350795629774, 0.843653617130814, 0.986280636989756, 0.843715831942116, 0.843389321159068, 0.844592714708563, 0.843679387236877, 0.986504099196833, 0.995507366217762, 0.986391627421766, 0.987799167927008, 0.843016115096843, 0.84359108516855, 0.84514004761032, 0.84470785418946, 0.841871045962236, 0.842226218622356, 0.841557968787396, 0.983823390773521, 0.992026263373972, 0.845073261174617, 0.846161456066393, 0.844529233169539, 0.843878781240662, 0.844041564407653, 0.845339597027985, 0.986982659093, 0.844261876388914, 0.842919954810567, 0.987511854188552, 0.990593168995056, 1.0));
	sim.setValue("W", c(0.834214385035553, 1.0, 1.00591218570444, 0.993586206171342, 0.984465683850228, 0.835625734115416, 0.994620578781022, 0.991282818533625, 0.986737929430977, 0.985204472056791, 0.999434371806485, 1.0, 0.985762896105132, 0.98955035032502, 0.997187759348963, 0.992828315249167, 1.00348228493503, 1.00405221126661, 0.992169356642916, 0.993246712202753, 0.995925149666022, 1.00021333889496, 1.00157597423089, 0.996953382912049, 0.991666362218472, 0.991209724959341, 1.00799499061824, 1.00504064785462, 0.993357930986308, 1.00580713205323, 0.994076666369983, 0.988184766105403, 0.996516116112865, 0.995395110222785, 1.00576814063728, 0.990221507245251, 1.0, 0.999794180444121, 0.99603728197872, 1.00313605723297, 0.997961519099807, 0.994477729847717, 0.995149814797897, 0.993949791904291, 0.98868806212732, 1.0055199979341, 0.987951608488982, 0.989710537991394, 1.00492780135377, 1.00104264096065, 1.0));
	sim.setValue("X", c(0.834214385035553, 0.839442229698759, 0.841686849904925, 0.836565676680632, 0.838717957990266, 0.835625734115416, 0.837681049779115, 0.837420398697593, 0.835338597084704, 0.837206056988676, 0.83778420238742, 0.842217722898904, 0.840954574581512, 0.838692226830708, 0.840075497346699, 0.830820541977203, 0.844055975136899, 0.842313692439437, 0.840832041134712, 0.839829422323288, 0.843653617130814, 0.986280482688223, 0.839322333149262, 0.834874501314598, 0.837295225884332, 0.836871378482087, 0.843295242238123, 0.989986557404871, 0.984354114179914, 0.987799167927008, 0.833671064971029, 0.84359108516855, 0.841973404185175, 0.840773690887687, 0.838307587072434, 0.839629329108983, 0.839556088607296, 0.838947864161109, 0.978947047650039, 0.845073261174617, 0.846161456066393, 0.835929564494643, 0.834881373656676, 0.840068146394994, 0.837570256716978, 0.840846002568504, 0.837269428217986, 0.835574044714891, 0.987511822331316, 0.988555612447242, 1.0));
	sim.setValue("Y", c(0.83765302059917, 0.845582581502062, 0.84616271892082, 0.838407107206407, 1.0, 0.981590853872871, 0.838131180536411, 0.987799696485703, 0.837258391599357, 0.838357617182339, 0.98617104565998, 0.980144826808078, 1.0, 0.842703959191998, 0.994825885747022, 0.837825007783673, 0.988957203010657, 0.987307160693399, 0.988686164395741, 0.989763559069637, 0.990996404087255, 0.989763708987678, 0.985204082537654, 0.841580370947407, 0.841761437553156, 0.841072902614964, 0.989987251614723, 1.00551963360958, 1.0, 0.991282320248082, 0.840972315080669, 0.991667313709026, 0.84301764573618, 0.986391707153259, 0.843244520349355, 0.840525575897183, 0.978797268810746, 0.990790243105672, 1.0, 0.986391460796337, 0.994478392719541, 0.842501907630287, 0.842090409012921, 0.98494648012728, 0.842337408112927, 0.997432248612792, 0.841061689611669, 0.839915249884285, 0.999999033043471, 0.998680812569137, 1.0));

	sim.setValue("fitness_profiles0",c(49, 2, 11, 21, 10, 48, 21, 34, 6, 28, 38, 26, 0, 32, 4, 5, 8, 20, 13, 22, 20, 37, 38, 42, 7, 11, 43, 0, 44, 0, 48, 47, 21, 10, 1, 24, 25, 45, 34, 33, 28, 43, 13, 46, 1, 15, 41, 19, 4, 29, 2, 13, 36, 2, 14, 29, 41, 18, 28, 12, 39, 44, 28, 40, 18, 10, 38, 3, 13, 17, 30, 29, 27, 14, 45, 41, 31, 35, 42, 27, 31, 19, 28, 39, 10, 32, 26, 11, 4, 42, 42, 36, 12, 24, 28, 17, 8, 41, 9, 39, 15, 7, 7, 27, 4, 29, 25, 28, 12, 22, 33, 6, 44, 2, 6, 42, 14, 44, 30, 13, 14, 32, 47, 37, 34, 43, 34, 30, 13, 9, 44, 18, 29, 48, 22, 39, 26, 27, 43, 27, 11, 45, 1, 26, 4, 2, 1, 46, 38, 24, 11, 37, 5, 42, 46, 17, 31, 0, 2, 21, 23, 42, 30, 27, 46, 11, 24, 16, 43, 11, 19, 12, 34, 46, 25, 11, 39, 28, 35, 8, 29, 3, 48, 20, 22, 15, 14, 18, 14, 12, 11, 17, 43, 46, 3, 25, 31, 6, 33, 12, 42, 13, 18, 37, 34, 35, 1, 45, 21, 40, 14, 47, 21, 35, 1, 43, 43, 40, 10, 12, 12, 14, 44, 44, 22, 24, 39, 43, 30, 16, 46, 2, 36, 46, 24, 44, 46, 41, 20, 5, 40, 16, 16, 12, 35, 42, 22, 28, 15, 8, 30, 37, 12, 20, 12, 34, 11, 45, 33, 18, 6, 14, 13, 21, 4, 10, 9, 3, 12, 31, 40, 39, 37, 9, 3, 11, 17, 44, 10, 10, 21, 24, 22, 9, 45, 16, 39, 9, 37, 21, 27, 16, 6, 16, 35, 12, 17, 21, 14, 49));
	defineConstant("start_stop_codon_positions",matrix(c(0, 897), ncol = 2, byrow = T));

	defineConstant("seq_length", 900);
	get_fitness();

	sim.setValue("fixations_p1", sim.chromosome.ancestralNucleotides(format = "integer"));
	sim.setValue("fixations_counted_p1", 0);
	sim.setValue("dN_p1", 0);
	sim.setValue("dS_p1", 0);
	sim.setValue("subs_p1", "\n\nSubstitutions:");
}


function (void) get_fitness (void){
	poses = start_stop_codon_positions;

	for (row_num in (0:(nrow(start_stop_codon_positions)-1))){
		fitnesses = c();
		aas = codonsToAminoAcids(sim.chromosome.ancestralNucleotides(drop(poses[row_num,0]), drop(poses[row_num, 1])+2, "codon"), paste = F);

		sim.setValue("ancestral_aa_seq" + asString(row_num),aas); 

		count = 0;
		for (aa in aas){
			fitnesses = c(fitnesses, sim.getValue(aa)[sim.getValue("fitness_profiles" + row_num)[count]]);
			count = count + 1; 
		}

		sim.setValue("ancestral_fitnesses" + asString(row_num), fitnesses);
		sim.setValue("ancestral_fitness_value" + asString(row_num), sum(fitnesses));
		sim.setValue("ancestral_aas" + asString(row_num), aas);

	}
}


function (float) get_genome_fitness (object nucs){
	fitness_value = 0.0;
	for (row_num in (0:(nrow(start_stop_codon_positions) -1))){

		anc_fit_val =  sim.getValue("ancestral_fitness_value" + asString(row_num));

		starting_pos = drop(start_stop_codon_positions[row_num,0]);
		ending_pos = drop(start_stop_codon_positions[row_num,1])+2;
		aa_stop_pos = (ending_pos - starting_pos + 1)/3 - 1;
		aa_seq = codonsToAminoAcids(nucs.nucleotides(start = starting_pos, end = ending_pos, format = "codon"), paste = F);

		poses = (aa_seq != sim.getValue("ancestral_aas" + row_num));

		if(sum(poses) == 0){
			codon_fit = anc_fit_val;
		}
		else if(any(poses[0] | poses[aa_stop_pos])){
			codon_fit = 0;
		}
		else{
		fitness_vals = sim.getValue("ancestral_fitnesses"+row_num);
			fitness_vals[poses] = sapply(which(poses), "sim.getValue(aa_seq[applyValue])[sim.getValue(\"fitness_profiles\" + row_num)[applyValue + starting_pos]];");

			if(any(aa_seq[poses] == "X")){
				early_stop_point = which(aa_seq[poses] == "X")[0];
				fitness_vals = fitness_vals[starting_pos:early_stop_point];
			}

			codon_fit = sum(fitness_vals);
		}

		fitness_value = fitness_value + codon_fit;
	}

	return fitness_value;
}


fitnessEffect() {return((get_genome_fitness(individual.genome1)+get_genome_fitness(individual.genome2)) / 594.7619983804334);//If error says total fitness < 0.0, mutation rate is lethal
}


1001 late() {
	setup_fitness();
	sim.readFromPopulationFile("p1.txt");
	p1.setSubpopulationSize(100);

	sim.setValue("fixations_p1", codonsToNucleotides(nucleotidesToCodons(readFile("p1_fixed_mutations.txt")), format = "integer"));
	sim.setValue("fixations_counted_p1", 0);
	sim.setValue("dN_p1", 0);
	sim.setValue("dS_p1", 0);
	sim.setValue("subs_p1", "\n\nSubstitutions:");
}


1001:1086late () {

	if (sim.cycle%100 == 0) {
		writeFile("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_EMB/EX_5/backupFiles/p2.fasta",(">parent_ancestral_to_load\n" + sim.chromosome.ancestralNucleotides()));
		sim.outputFull("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_EMB/EX_5/backupFiles/p2.txt");
	};
}


1087 late() {
	sim.outputFull("p2.txt");
	writeFile("p2.fasta", (">parent_ancestral_to_load\n" + sim.chromosome.ancestralNucleotides()));
	writeFile("/work/dk_lab/work/afarinesh/SLiM_Tree_paper_EMB/EX_5/p2_fixed_mutations.txt", paste(codonsToNucleotides(nucleotidesToCodons(sim.getValue("fixations_p1"))), sep = ""));
	sim.outputFixedMutations();
	system("sbatch \"/work/dk_lab/work/afarinesh/SLiM_Tree_paper_EMB/EX_5/slimScripts/tree_p3.sh\"");
	system("sbatch \"/work/dk_lab/work/afarinesh/SLiM_Tree_paper_EMB/EX_5/slimScripts/tree_p6.sh\"");
}